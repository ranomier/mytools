#!/usr/bin/env python3
"""Parse git help --all --no-aliases output to extract commands by category."""

import subprocess
import json


def parse_git_help():
    """Parse git help and return commands organized by category."""
    result = subprocess.run(
        ["git", "help", "--all", "--no-aliases"],
        capture_output=True,
        text=True,
        check=True
    )

    commands = {}
    current_category = None
    skip_lines = 1

    for line in result.stdout.splitlines():
        if skip_lines > 0:
            skip_lines -= 1
            continue

        stripped = line.strip()

        if not stripped:
            continue

        if line.startswith(" "):
            # Command line
            if current_category:
                parts = stripped.split(None, 1)
                help_text = parts[1] if len(parts) > 1 else ""
                commands[current_category][parts[0]] = help_text
        else:
            # Category header
            current_category = stripped
            commands[current_category] = {}

    return commands


def main():
    commands = parse_git_help()
    print(json.dumps(commands))


if __name__ == "__main__":
    main()
